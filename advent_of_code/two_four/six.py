import numpy as np


def map_to_2d(map: str):
    return np.array([list(map_1d) for map_1d in map.split("\n")])


def update_guard_position(map) -> list[int]:
    for i, row in enumerate(map):
        guess = np.char.find(row, "^")

        if np.any(guess == 0):
            guard_index = np.where(guess == 0)

            # col x row
            return [int(np.min(guard_index)), i]


def count_guard_positions(map: str) -> int:
    map = map_to_2d(map)
    map = np.rot90(map, 3)

    guard_position = update_guard_position(map)

    print(guard_position)

    guard_escaped = False

    while not guard_escaped:
        print(map.shape)
        obstacles = np.char.find(map[guard_position[1]][guard_position[0] :], "#")

        if np.any(obstacles == 0):
            print("obstacle hit")
            obstacle_indices = np.where(obstacles == 0)
            print(f"obstacle_indices: {obstacle_indices}")
            map[guard_position[1]][
                guard_position[0] : guard_position[0] + int(np.min(obstacle_indices)) - 1
            ] = "X"
            map[guard_position[1]][guard_position[0] + int(np.min(obstacle_indices)) - 1] = "^"
            map[guard_position[1]][guard_position[0]] = "X"
            print(f"number of X's: {int(np.array2string(map).count('X'))}")

            map = np.rot90(map, 1)
            guard_position = update_guard_position(map)

        else:
            map[guard_position[1]][guard_position[0] :] = "X"
            map[guard_position[1]][guard_position[0]] = "X"

            guard_escaped = True

    return int(np.array2string(map).count("X"))


def guard_map() -> str:
    return """......##...#...#....#.......#....................##............#.#..#.......#.........................................#...........
..................................#.............#................................#..........##..................#.................
....#......................#................#...........................................#....................................#....
............#..............#...#...#...............#..........#.#....#..........................#....##...........................
....#.............#.....#.....................................................................#...#..........................#....
.................#............#......................#.................#.............#..................#.........................
................#...............#....................#...#..#...#.#.....................................................#.........
..............#.#...............................................................#....................#.......#....................
.............#...#..#............................#..............#..#.........................................#....................
.........................#.........#..#.......#...#..............#..#..............................#.........#............#.......
#...............................................................................................................#.................
..........................#.....#.........................#...................#.......#.........................#.................
...........#...........#........#........................#..........#.#.................#........#............#...............#...
..#..#................#...................................................#..................................................#....
.....#............................#..........................................................................#....................
................#.....#...........................#..........................................#.........#........................#.
..#...........................................##............#.........#..........................#.......................#.....#..
.....................#.............#.....#.......#.##.....#......................................#.#..#.#.........................
.......#...##.....#..........#...............#....#..........................#..............................................##....
..#.......#..................##..............#..........................#.#....#....#....................#.#.#...............#....
....................#.......#.......#............#..............#.......#.........#...#.....#........#.#..........................
...............................................#.....#........................................#..#.........#..........#...........
............#...#.............................................................................#.......##..........................
##..........................#...........................#..............................#..........................................
..............................................#.............................................#.................................#...
.............#..............#................##...........#...............#.......................................................
......#............#.......#..#....#.............................................................................#.#..............
..#..##..#..................#...............................................##......#........................................#....
..#...............................#.#........#................................................#.....#........#.#..................
.........#.......#.....................................#............................#..............................#..............
..........................................................................................................#.....................#.
....................#......................................#..........................#.........................##................
........#..............................................................................#.#..................#..................#..
........................................................^..#...................#....#..............##.............................
..#.#........................................................#..#..................#.....................................#....#...
.........................#....#............................#......................................................................
.#......#.............................................................................................#....................###....
...........#...#.#............#........................................................................#..........................
......#..........#.............................#.#.................................#...#.............#.#........................#.
...............................................#..........#.......#.........#........................................#.#..........
.................#.....................#.......#..................................................................................
.#...............#.........#...................#..............#........................#.....#....................................
...........#..............#..................................................................#...................................#
.................#.............#...........#.......................................#......................#......#..........#.....
........#..#.................#..........#....................................................#.....#...........#.................#
.....................#..#.................#......#......#..#..#..........#........................#...........................##..
.................#........#....#.................................................#.#.........................#............#..#....
.....................#...............##...................#.....#..#............................#.#.............#.................
.#..#......##...............#.......#..........................................................................#......#...........
#..#...................................#.#................#.....#.................................#...........................#...
..............#............................#............#...#...#.............#..........#............#...#............#..........
..........##.................#................................#...........#.#....#...............................................#
......#...........#.............#..........#.............#............#...................#.......................#...............
..............#.......#...........................................................................................................
...#................................................................#...............................#....#...............#........
...#..##................#..............................................................................#..........##.#............
.#........#..........#..................#......................#...........#......................................................
....#.......................#...#...........................................#..................#...............................#..
.............................#...........#..........#.................#.....................................................#.....
...........#.........#............#...............................#................#..............#.........................#.....
..........#........#.....#.....................................#.................#.....................................#..#.......
...#.......#...................................................................#.................#................................
.#....#........#..............................#........#.....#........#..#...#.#......................#..........................#
.....................................................................#....................#.......................................
.............................#..............................#.#....................................................#............#.
..#.....#.......#.......#......................#.#.#.........................................................#.....#........#.....
...............#..........#..#....#..................#..........................................#.................................
............#...................#................#.............................................................................#..
........#...#......................................##....................#..................#..........##............#...#........
......................#......#......#.#.........................................................................#.............#...
........#......................................................................................#.................#................
.................................................#....................#..............##.......................................#..#
.............#..........................................................#.................#..........................#....#......#
......................#.....................#............................#..................#...........#.........................
#..............#...........................#...#.#................................................................................
.......#............................#...........................................................#...............#.................
........................#..................................................................................#......................
...................#..........................#.........#........#...........................#....................................
.............#............#.......................................................................................##....#.........
................#.........#.....................................................................................................#.
........#.............................#.................................#.......##..............#............................#....
#........#.....#.....#.......#...............................#....................................................#..............#
........................#.............................#.....#...........#........#............#...................................
..................#...........#...#.............................................................................#...............#.
...................#..................#...................#..............................#....#...........#..............#........
...............#................#.#....................#.........#.........#.............#.........#......#..................#....
..................#.............................#...........................#....#....#......#..#.#....................#..........
...#.......................................#...............................................................#................#.....
...................#.........................................................#....................................................
.................#..............................#.................................................................................
.............#.......#...#....................................................#........#....................................#...#.
..............#...................#.#..........#....................................................#....#...#.##....#............
........#..#...........................................#.........#...#...............#.........................#..................
#.....#...........................................#.................................................#.............................
#...........................................#..........#..........................................#...............#...............
............................#.................................................#...#...............................................
.#...................#.......................................................................................#......#...##..#.....
.....#..#...............#........#....#.........#........................#.............#..........................................
...................#................#........................................#.#..................................................
......#.#...........................#...................#..........#..........#......#............................................
..........................#.#..............#............#.#.......................................................................
...#..#........................#..............................................#..#...#.....#........#.............................
..........................#.....................#.........................................................#............#.#........
............................#.....................#.............#.................................................................
..........................................#..#.................................................................#......#.#.#.......
..........##......................................#................................##....................#..#.....................
..............#.......................................................#...........................................................
..........#........#........................................................................................#........#...#........
......................#.#...................#...............#.....#......................#.....#.......#.......#..........#.......
......#..#....#..................#.........................................#......................................................
...............#.....#..#..........................................##.........................................##.............#....
.....................#..................#..................................#...................#............................#.#...
..#................#..#................................................#...........#..........#.............#...................#.
.......#.............#.......................................................................#...#.........................##..#..
...#...................#..................#.............#..#.........................................#........##..................
.................................#...........#........#.....................#.........................#..#........................
.......#..................#..................................#......................................#.#....................#......
..................................................................................#...........#....#.......#......#..........#....
........##.........................................................#.......................#........#............#................
...#...............##.#..................#....................................#.............#.................#...................
..................##.........#...................#......#................#......................................................#.
.#....................#............#..............#.............#.........#........................................#......#..#....
...............#...........................................................#........................#.............#...............
#............................#...................#...............................##..#...............#..........................#.
................#.............#..........#.........#..........................#....#..............................#..............#
...................................#.........................................#....................................................
....#................................................................#.#..#..........#....#.............................#.........
...........#.............#..........#........#...#...#........#.............#.......................................##............
.........#.......................#..........#....#.......................................#.....#...#.#..........#.................
.......................#...........#.......#......#.#...............................................#.................#.#........."""
